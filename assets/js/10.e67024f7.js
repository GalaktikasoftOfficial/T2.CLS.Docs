(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{367:function(s,t,e){s.exports=e.p+"assets/img/Storage_service_start.5ff689ae.png"},422:function(s,t,e){"use strict";e.r(t);var a=e(42),r=Object(a.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"сервис-управления-хранилищем"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#сервис-управления-хранилищем"}},[s._v("#")]),s._v(" Сервис управления хранилищем")]),s._v(" "),a("p",[s._v("Данный сервис устанавливается на одной машине с ClickHouse или так, что бы был доступ к файлам данных ClickHouse для отсоединения и присоединения партиций.")]),s._v(" "),a("h4",{attrs:{id:"подготовка"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#подготовка"}},[s._v("#")]),s._v(" Подготовка")]),s._v(" "),a("p",[s._v("Необходимо создать пользователя, от имени которого будет работать служба:")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("adduser t2-cls\n")])])]),a("p",[s._v("Создать директорию и скопировать в неё содержимое архива "),a("code",[s._v("T2.CLS.StorageService.zip")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("mkdir /var/lib/t2/t2-cls-storaged/ -p\n")])])]),a("p",[s._v("Назначить нового пользователя владельцем данной директории:")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("cd /var/lib/t2\nchown -R t2-cls:t2-cls t2-cls-storaged\n")])])]),a("p",[s._v("Т.к. служба занимается архивированием устаревших партиций, у неё должен быть доступ к директории данных "),a("strong",[s._v("Clickhouse")]),s._v(", для этого необходимо добавить созданного пользователя в состав группы clickhouse")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("usermod -aG clickhouse t2-cls\n")])])]),a("h4",{attrs:{id:"конфигурация-службы"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#конфигурация-службы"}},[s._v("#")]),s._v(" Конфигурация службы")]),s._v(" "),a("p",[s._v("В настройках службы (файл "),a("code",[s._v("appsettings.json")]),s._v(") указать подключение к БД а также путь к директории данных Clickhouse и путь хранению архивов.\nНиже представлен стандартные параметры в секции настройки.")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v('"Storage": {\n    "HttpUrl": "http://localhost:8123/",\n    "User": "default",\n    "Password": "",\n    "DataBase": "T2Logs",\n    "DataPath": "/var/lib/clickhouse/data",\n    "ArchivePath": "/var/lib/clickhouse/archive"\n}\n')])])]),a("p",[s._v("Проверить, что служба запускается и работает:")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("dotnet /var/lib/t2/t2-cls-storaged/T2.CLS.StorageService.dll\n")])])]),a("p",[s._v("Результатом будет следующее:")]),s._v(" "),a("p",[a("img",{attrs:{src:e(367),alt:"img"}})]),s._v(" "),a("p",[s._v("Для остановки сервиса необходимо нажать "),a("code",[s._v("ctrl+C")]),s._v(".")]),s._v(" "),a("h4",{attrs:{id:"создание-демона"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#создание-демона"}},[s._v("#")]),s._v(" Создание демона")]),s._v(" "),a("p",[s._v("В директории "),a("code",[s._v("/usr/lib/systemd/system")]),s._v(" создать конфигурационный файл службы "),a("code",[s._v("t2-cls-storaged.service")]),s._v(" и открыть на редактирование.")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("sudo touch /usr/lib/systemd/system/t2-cls-storaged.service\nsudo nano /usr/lib/systemd/system/t2-cls-storaged.service\n")])])]),a("p",[s._v("В файле "),a("code",[s._v("t2-cls-storaged.service")]),s._v(" добавить строки содержимым:")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("[Unit]  \nDescription=T2 CLS Storage Service  \n  \n[Service]  \nExecStart=dotnet /var/lib/t2/t2-cls-storaged/T2.CLS.StorageService.dll\nWorkingDirectory=/var/lib/t2/t2-cls-storaged\nUser=t2-cls  \nGroup=t2-cls\nRestart=on-failure  \nSyslogIdentifier=t2-cls-storaged \nPrivateTmp=true  \n  \n[Install]  \nWantedBy=multi-user.target\n")])])]),a("p",[s._v("Перезагрузить конфигурацию служб и создать метассылку для нашей службы:")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("systemctl daemon-reload  \nsystemctl enable t2-cls-storaged\n")])])]),a("p",[s._v("Запустить службу и проверить её статус:")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("systemctl start t2-cls-storaged\nsystemctl status t2-cls-storaged\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);